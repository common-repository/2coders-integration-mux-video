/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@mux/upchunk@3.3.2/dist/upchunk.js
 * Url file: https://cdn.jsdelivr.net/npm/@mux/upchunk@3.3.2/dist/upchunk.min.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("UpChunk",[],t):"object"==typeof exports?exports.UpChunk=t():e.UpChunk=t()}(this,(()=>{var e,t,n={},r={exports:n},i=Object.create,s=Object.defineProperty,a=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,u=Object.getPrototypeOf,l=Object.prototype.hasOwnProperty,h=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),c=(e,t,n,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let i of o(t))!l.call(e,i)&&i!==n&&s(e,i,{get:()=>t[i],enumerable:!(r=a(t,i))||r.enumerable});return e},p=h(((e,t)=>{var n;n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t.exports=n})),d=h(((e,t)=>{t.exports=function(e){if(!e)return!1;var t=n.call(e);return"[object Function]"===t||"function"==typeof e&&"[object RegExp]"!==t||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)};var n=Object.prototype.toString})),f=h(((e,t)=>{var n=function(e){return e.replace(/^\s+|\s+$/g,"")},r=function(e){return"[object Array]"===Object.prototype.toString.call(e)};t.exports=function(e){if(!e)return{};for(var t={},i=n(e).split("\n"),s=0;s<i.length;s++){var a=i[s],o=a.indexOf(":"),u=n(a.slice(0,o)).toLowerCase(),l=n(a.slice(o+1));void 0===t[u]?t[u]=l:r(t[u])?t[u].push(l):t[u]=[t[u],l]}return t}})),m=h(((e,t)=>{t.exports=function(){for(var e={},t=0;t<arguments.length;t++){var r=arguments[t];for(var i in r)n.call(r,i)&&(e[i]=r[i])}return e};var n=Object.prototype.hasOwnProperty})),g=h(((e,t)=>{"use strict";var n=p(),r=d(),i=f(),s=m();function a(e,t,n){var i=e;return r(t)?(n=t,"string"==typeof e&&(i={uri:e})):i=s(t,{uri:e}),i.callback=n,i}function o(e,t,n){return u(t=a(e,t,n))}function u(e){if(void 0===e.callback)throw new Error("callback argument missing");var t=!1,n=function(n,r,i){t||(t=!0,e.callback(n,r,i))};function r(){var e=void 0;if(e=u.response?u.response:u.responseText||function(e){try{if("document"===e.responseType)return e.responseXML;var t=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;if(""===e.responseType&&!t)return e.responseXML}catch{}return null}(u),b)try{e=JSON.parse(e)}catch{}return e}function s(e){return clearTimeout(c),e instanceof Error||(e=new Error(""+(e||"Unknown XMLHttpRequest Error"))),e.statusCode=0,n(e,y)}function a(){if(!h){var t;clearTimeout(c),t=e.useXDR&&void 0===u.status?200:1223===u.status?204:u.status;var s=y,a=null;return 0!==t?(s={body:r(),statusCode:t,method:d,headers:{},url:p,rawRequest:u},u.getAllResponseHeaders&&(s.headers=i(u.getAllResponseHeaders()))):a=new Error("Internal XMLHttpRequest Error"),n(a,s,s.body)}}var u=e.xhr||null;u||(u=e.cors||e.useXDR?new o.XDomainRequest:new o.XMLHttpRequest);var l,h,c,p=u.url=e.uri||e.url,d=u.method=e.method||"GET",f=e.body||e.data,m=u.headers=e.headers||{},g=!!e.sync,b=!1,y={body:void 0,headers:{},statusCode:0,method:d,url:p,rawRequest:u};if("json"in e&&!1!==e.json&&(b=!0,m.accept||m.Accept||(m.Accept="application/json"),"GET"!==d&&"HEAD"!==d&&(m["content-type"]||m["Content-Type"]||(m["Content-Type"]="application/json"),f=JSON.stringify(!0===e.json?f:e.json))),u.onreadystatechange=function(){4===u.readyState&&setTimeout(a,0)},u.onload=a,u.onerror=s,u.onprogress=function(){},u.onabort=function(){h=!0},u.ontimeout=s,u.open(d,p,!g,e.username,e.password),g||(u.withCredentials=!!e.withCredentials),!g&&e.timeout>0&&(c=setTimeout((function(){if(!h){h=!0,u.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",s(e)}}),e.timeout)),u.setRequestHeader)for(l in m)m.hasOwnProperty(l)&&u.setRequestHeader(l,m[l]);else if(e.headers&&!function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(u.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(u),u.send(f||null),u}t.exports=o,t.exports.default=o,o.XMLHttpRequest=n.XMLHttpRequest||function(){},o.XDomainRequest="withCredentials"in new o.XMLHttpRequest?o.XMLHttpRequest:n.XDomainRequest,function(e,t){for(var n=0;n<e.length;n++)t(e[n])}(["get","put","post","patch","head","delete"],(function(e){o["delete"===e?"del":e]=function(t,n,r){return(n=a(t,n,r)).method=e.toUpperCase(),u(n)}}))})),b={};function y(e,t,...n){if(!e)throw new TypeError(k(t,n))}function k(e,t){let n=0;return e.replace(/%[os]/gu,(()=>v(t[n++])))}function v(e){return"object"!=typeof e||null===e?String(e):Object.prototype.toString.call(e)}((e,t)=>{for(var n in t)s(e,n,{get:t[n],enumerable:!0})})(b,{ChunkedStreamIterable:()=>fe,UpChunk:()=>Se,createUpload:()=>Ce,getChunkSizeError:()=>de,isIncompleteChunkUploadNeedingRetry:()=>ve,isValidChunkSize:()=>pe}),r.exports=(e=b,c(s({},"__esModule",{value:!0}),e));var S,C="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:void 0,w=class{constructor(e,t){this.code=e,this.message=t}warn(...e){var t;try{S;let n=(null!==(t=(new Error).stack)&&void 0!==t?t:"").replace(/^(?:.+?\n){2}/gu,"\n");console.warn(this.message,...e,n)}catch{}}},E=new w("W01","Unable to initialize event under dispatching."),z=new w("W02","Assigning any falsy value to 'cancelBubble' property has no effect."),R=new w("W03","Assigning any truthy value to 'returnValue' property has no effect."),T=new w("W04","Unable to preventDefault on non-cancelable events."),O=new w("W05","Unable to preventDefault inside passive event listener invocation."),P=new w("W06","An event listener wasn't added because it has been added already: %o, %o"),x=new w("W07","The %o option value was abandoned because the event listener wasn't added as duplicated."),_=new w("W08","The 'callback' argument must be a function or an object that has 'handleEvent' method: %o"),j=(new w("W09","Event attribute handler must be a function: %o"),class{static get NONE(){return I}static get CAPTURING_PHASE(){return A}static get AT_TARGET(){return B}static get BUBBLING_PHASE(){return L}constructor(e,t){Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});let n=null!=t?t:{};N.set(this,{type:String(e),bubbles:Boolean(n.bubbles),cancelable:Boolean(n.cancelable),composed:Boolean(n.composed),target:null,currentTarget:null,stopPropagationFlag:!1,stopImmediatePropagationFlag:!1,canceledFlag:!1,inPassiveListenerFlag:!1,dispatchFlag:!1,timeStamp:Date.now()})}get type(){return D(this).type}get target(){return D(this).target}get srcElement(){return D(this).target}get currentTarget(){return D(this).currentTarget}composedPath(){let e=D(this).currentTarget;return e?[e]:[]}get NONE(){return I}get CAPTURING_PHASE(){return A}get AT_TARGET(){return B}get BUBBLING_PHASE(){return L}get eventPhase(){return D(this).dispatchFlag?2:0}stopPropagation(){D(this).stopPropagationFlag=!0}get cancelBubble(){return D(this).stopPropagationFlag}set cancelBubble(e){e?D(this).stopPropagationFlag=!0:z.warn()}stopImmediatePropagation(){let e=D(this);e.stopPropagationFlag=e.stopImmediatePropagationFlag=!0}get bubbles(){return D(this).bubbles}get cancelable(){return D(this).cancelable}get returnValue(){return!D(this).canceledFlag}set returnValue(e){e?R.warn():F(D(this))}preventDefault(){F(D(this))}get defaultPrevented(){return D(this).canceledFlag}get composed(){return D(this).composed}get isTrusted(){return!1}get timeStamp(){return D(this).timeStamp}initEvent(e,t=!1,n=!1){let r=D(this);r.dispatchFlag?E.warn():N.set(this,{...r,type:String(e),bubbles:Boolean(t),cancelable:Boolean(n),target:null,currentTarget:null,stopPropagationFlag:!1,stopImmediatePropagationFlag:!1,canceledFlag:!1})}}),I=0,A=1,B=2,L=3,N=new WeakMap;function D(e,t="this"){let n=N.get(e);return y(null!=n,"'%s' must be an object that Event constructor created, but got another one: %o",t,e),n}function F(e){e.inPassiveListenerFlag?O.warn():e.cancelable?e.canceledFlag=!0:T.warn()}Object.defineProperty(j,"NONE",{enumerable:!0}),Object.defineProperty(j,"CAPTURING_PHASE",{enumerable:!0}),Object.defineProperty(j,"AT_TARGET",{enumerable:!0}),Object.defineProperty(j,"BUBBLING_PHASE",{enumerable:!0});var M=Object.getOwnPropertyNames(j.prototype);for(let e=0;e<M.length;++e)"constructor"!==M[e]&&Object.defineProperty(j.prototype,M[e],{enumerable:!0});void 0!==C&&void 0!==C.Event&&Object.setPrototypeOf(j.prototype,C.Event.prototype);var U,H={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};function X(e){let t=Object.keys(H);for(let n=0;n<t.length;++n){let r=t[n],i=H[r];Object.defineProperty(e,r,{get:()=>i,configurable:!0,enumerable:!0})}}var W=class extends j{static wrap(e){return new(G(e))(e)}constructor(e){super(e.type,{bubbles:e.bubbles,cancelable:e.cancelable,composed:e.composed}),e.cancelBubble&&super.stopPropagation(),e.defaultPrevented&&super.preventDefault(),V.set(this,{original:e});let t=Object.keys(e);for(let n=0;n<t.length;++n){let r=t[n];r in this||Object.defineProperty(this,r,Y(e,r))}}stopPropagation(){super.stopPropagation();let{original:e}=q(this);"stopPropagation"in e&&e.stopPropagation()}get cancelBubble(){return super.cancelBubble}set cancelBubble(e){super.cancelBubble=e;let{original:t}=q(this);"cancelBubble"in t&&(t.cancelBubble=e)}stopImmediatePropagation(){super.stopImmediatePropagation();let{original:e}=q(this);"stopImmediatePropagation"in e&&e.stopImmediatePropagation()}get returnValue(){return super.returnValue}set returnValue(e){super.returnValue=e;let{original:t}=q(this);"returnValue"in t&&(t.returnValue=e)}preventDefault(){super.preventDefault();let{original:e}=q(this);"preventDefault"in e&&e.preventDefault()}get timeStamp(){let{original:e}=q(this);return"timeStamp"in e?e.timeStamp:super.timeStamp}},V=new WeakMap;function q(e){let t=V.get(e);return y(null!=t,"'this' is expected an Event object, but got",e),t}var $=new WeakMap;function G(e){let t=Object.getPrototypeOf(e);if(null==t)return W;let n=$.get(t);return null==n&&(n=function(e,t){class n extends e{}let r=Object.keys(t);for(let e=0;e<r.length;++e)Object.defineProperty(n.prototype,r[e],Y(t,r[e]));return n}(G(t),t),$.set(t,n)),n}function Y(e,t){let n=Object.getOwnPropertyDescriptor(e,t);return{get(){let e=q(this).original,n=e[t];return"function"==typeof n?n.bind(e):n},set(e){q(this).original[t]=e},configurable:n.configurable,enumerable:n.enumerable}}function J(e){return 1==(1&e.flags)}function Q(e){return 2==(2&e.flags)}function Z(e){return 4==(4&e.flags)}function K(e){return 8==(8&e.flags)}function ee({callback:e},n,r){try{"function"==typeof e?e.call(n,r):"function"==typeof e.handleEvent&&e.handleEvent(r)}catch(e){!function(e){try{let n=e instanceof Error?e:new Error(v(e));if(t)return void t(n);if("function"==typeof dispatchEvent&&"function"==typeof ErrorEvent)dispatchEvent(new ErrorEvent("error",{error:n,message:n.message}));else if("undefined"!=typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",n);console.error(n)}catch{}}(e)}}function te({listeners:e},t,n){for(let r=0;r<e.length;++r)if(e[r].callback===t&&J(e[r])===n)return r;return-1}function ne(e,t,n){let r=te(e,t,n);return-1!==r&&re(e,r)}function re(e,t,n=!1){let r=e.listeners[t];return function(e){e.flags|=8}(r),r.signal&&r.signal.removeEventListener("abort",r.signalListener),e.cow&&!n?(e.cow=!1,e.listeners=e.listeners.filter(((e,n)=>n!==t)),!1):(e.listeners.splice(t,1),!0)}$.set(Object.prototype,W),void 0!==C&&void 0!==C.Event&&$.set(C.Event.prototype,W);var ie=class{constructor(){se.set(this,Object.create(null))}addEventListener(e,t,n){let r=ae(this),{callback:i,capture:s,once:a,passive:o,signal:u,type:l}=function(e,t,n){var r;return oe(t),"object"==typeof n&&null!==n?{type:String(e),callback:null!=t?t:void 0,capture:Boolean(n.capture),passive:Boolean(n.passive),once:Boolean(n.once),signal:null!==(r=n.signal)&&void 0!==r?r:void 0}:{type:String(e),callback:null!=t?t:void 0,capture:Boolean(n),passive:!1,once:!1,signal:void 0}}(e,t,n);if(null==i||(null==u?void 0:u.aborted))return;let h=function(e,t){var n;return null!==(n=e[t])&&void 0!==n?n:e[t]={attrCallback:void 0,attrListener:void 0,cow:!1,listeners:[]}}(r,l),c=te(h,i,s);-1===c?function(e,t,n,r,i,s){let a;s&&(a=ne.bind(null,e,t,n),s.addEventListener("abort",a));let o=function(e,t,n,r,i,s){return{callback:e,flags:(t?1:0)|(n?2:0)|(r?4:0),signal:i,signalListener:s}}(t,n,r,i,s,a);e.cow?(e.cow=!1,e.listeners=[...e.listeners,o]):e.listeners.push(o)}(h,i,s,o,a,u):function(e,t,n,r){P.warn(J(e)?"capture":"bubble",e.callback),Q(e)!==t&&x.warn("passive"),Z(e)!==n&&x.warn("once"),e.signal!==r&&x.warn("signal")}(h.listeners[c],o,a,u)}removeEventListener(e,t,n){let r=ae(this),{callback:i,capture:s,type:a}=function(e,t,n){return oe(t),"object"==typeof n&&null!==n?{type:String(e),callback:null!=t?t:void 0,capture:Boolean(n.capture)}:{type:String(e),callback:null!=t?t:void 0,capture:Boolean(n)}}(e,t,n),o=r[a];null!=i&&o&&ne(o,i,s)}dispatchEvent(e){let t=ae(this)[String(e.type)];if(null==t)return!0;let n=e instanceof j?e:W.wrap(e),r=D(n,"event");if(r.dispatchFlag)throw function(e){return C.DOMException?new C.DOMException(e,"InvalidStateError"):(null==U&&(U=class e extends Error{constructor(t){super(t),Error.captureStackTrace&&Error.captureStackTrace(this,e)}get code(){return 11}get name(){return"InvalidStateError"}},Object.defineProperties(U.prototype,{code:{enumerable:!0},name:{enumerable:!0}}),X(U),X(U.prototype)),new U(e))}("This event has been in dispatching.");if(r.dispatchFlag=!0,r.target=r.currentTarget=this,!r.stopPropagationFlag){let{cow:e,listeners:i}=t;t.cow=!0;for(let s=0;s<i.length;++s){let a=i[s];if(!K(a)&&(Z(a)&&re(t,s,!e)&&(s-=1),r.inPassiveListenerFlag=Q(a),ee(a,this,n),r.inPassiveListenerFlag=!1,r.stopImmediatePropagationFlag))break}e||(t.cow=!1)}return r.target=null,r.currentTarget=null,r.stopImmediatePropagationFlag=!1,r.stopPropagationFlag=!1,r.dispatchFlag=!1,!r.canceledFlag}},se=new WeakMap;function ae(e,t="this"){let n=se.get(e);return y(null!=n,"'%s' must be an object that EventTarget constructor created, but got another one: %o",t,e),n}function oe(e){if("function"!=typeof e&&("object"!=typeof e||null===e||"function"!=typeof e.handleEvent)){if(null==e||"object"==typeof e)return void _.warn(e);throw new TypeError(k(_.message,[e]))}}var ue=Object.getOwnPropertyNames(ie.prototype);for(let e=0;e<ue.length;++e)"constructor"!==ue[e]&&Object.defineProperty(ie.prototype,ue[e],{enumerable:!0});void 0!==C&&void 0!==C.EventTarget&&Object.setPrototypeOf(ie.prototype,C.EventTarget.prototype);var le=((e,t,n)=>(n=null!=e?i(u(e)):{},c(!t&&e&&e.__esModule?n:s(n,"default",{value:e,enumerable:!0}),e)))(g()),he=512e3,ce=256,pe=(e,{minChunkSize:t=ce,maxChunkSize:n=he}={})=>null==e||"number"==typeof e&&e>=256&&e%256==0&&e>=t&&e<=n,de=(e,{minChunkSize:t=ce,maxChunkSize:n=he}={})=>new TypeError(`chunkSize ${e} must be a positive number in multiples of 256, between ${t} and ${n}`),fe=class{constructor(e,t={}){var n,r,i;if(this.readableStream=e,!pe(t.defaultChunkSize,t))throw de(t.defaultChunkSize,t);this.defaultChunkSize=null!=(n=t.defaultChunkSize)?n:30720,this.minChunkSize=null!=(r=t.minChunkSize)?r:ce,this.maxChunkSize=null!=(i=t.maxChunkSize)?i:he}get chunkSize(){var e;return null!=(e=this._chunkSize)?e:this.defaultChunkSize}set chunkSize(e){if(!pe(e,this))throw de(e,this);this._chunkSize=e}get chunkByteSize(){return 1024*this.chunkSize}async*[Symbol.asyncIterator](){let e,t=this.readableStream.getReader();try{for(;;){let{done:n,value:r}=await t.read();if(n){if(e){let t=e;e=void 0,yield t}break}let i=r instanceof Uint8Array?new Blob([r],{type:"application/octet-stream"}):r;for(e=e?new Blob([e,i]):i;e;){if(e.size===this.chunkByteSize){let t=e;e=void 0,yield t;break}if(e.size<this.chunkByteSize)break;{let t=e.slice(0,this.chunkByteSize);e=e.slice(this.chunkByteSize),yield t}}}}finally{if(e){let t=e;e=void 0,yield t}return void t.releaseLock()}}},me=[200,201,202,204,308],ge=[408,502,503,504],be=[308],ye=(e,t)=>!!e&&me.includes(e.statusCode),ke=(e,t)=>t.attemptCount>=t.attempts||!(ye(e)||((e,{retryCodes:t=ge})=>!e||t.includes(e.statusCode))(e,t)),ve=(e,t)=>{if(!e||!be.includes(e.statusCode)||!e.headers.range)return!1;let n=e.headers.range.match(/bytes=(\d+)-(\d+)/);return!!n&&parseInt(n[2],10)!==t.currentChunkEndByte},Se=class{static createUpload(e){return new Se(e)}constructor(e){this.endpoint=e.endpoint,this.file=e.file,this.headers=e.headers||{},this.method=e.method||"PUT",this.attempts=e.attempts||5,this.delayBeforeAttempt=e.delayBeforeAttempt||1,this.retryCodes=e.retryCodes||ge,this.dynamicChunkSize=e.dynamicChunkSize||!1,this.maxFileBytes=1024*(e.maxFileSize||0),this.chunkCount=0,this.attemptCount=0,this.offline=!1,this._paused=!1,this.success=!1,this.nextChunkRangeStart=0,this.chunkedStreamIterable=new fe(this.file.stream(),{...e,defaultChunkSize:e.chunkSize}),this.chunkedStreamIterator=this.chunkedStreamIterable[Symbol.asyncIterator](),this.totalChunks=Math.ceil(this.file.size/this.chunkByteSize),this.eventTarget=new ie,this.validateOptions(),this.getEndpoint().then((()=>this.sendChunks())),"undefined"!=typeof window&&(window.addEventListener("online",(()=>{!this.offline||(this.offline=!1,this.dispatch("online"),this.sendChunks())})),window.addEventListener("offline",(()=>{this.offline=!0,this.dispatch("offline")})))}get maxChunkSize(){var e,t;return null!=(t=null==(e=this.chunkedStreamIterable)?void 0:e.maxChunkSize)?t:he}get minChunkSize(){var e,t;return null!=(t=null==(e=this.chunkedStreamIterable)?void 0:e.minChunkSize)?t:ce}get chunkSize(){var e,t;return null!=(t=null==(e=this.chunkedStreamIterable)?void 0:e.chunkSize)?t:30720}set chunkSize(e){this.chunkedStreamIterable.chunkSize=e}get chunkByteSize(){return this.chunkedStreamIterable.chunkByteSize}get totalChunkSize(){return Math.ceil(this.file.size/this.chunkByteSize)}on(e,t){this.eventTarget.addEventListener(e,t)}once(e,t){this.eventTarget.addEventListener(e,t,{once:!0})}off(e,t){this.eventTarget.removeEventListener(e,t)}get paused(){return this._paused}abort(){var e;this.pause(),null==(e=this.currentXhr)||e.abort()}pause(){this._paused=!0}resume(){this._paused&&(this._paused=!1,this.sendChunks())}dispatch(e,t){let n=new CustomEvent(e,{detail:t});this.eventTarget.dispatchEvent(n)}validateOptions(){if(!this.endpoint||"function"!=typeof this.endpoint&&"string"!=typeof this.endpoint)throw new TypeError("endpoint must be defined as a string or a function that returns a promise");if(!(this.file instanceof File))throw new TypeError("file must be a File object");if(this.headers&&"function"!=typeof this.headers&&"object"!=typeof this.headers)throw new TypeError("headers must be null, an object, or a function that returns an object or a promise");if(!pe(this.chunkSize,{maxChunkSize:this.maxChunkSize,minChunkSize:this.minChunkSize}))throw de(this.chunkSize,{maxChunkSize:this.maxChunkSize,minChunkSize:this.minChunkSize});if(this.maxChunkSize&&("number"!=typeof this.maxChunkSize||this.maxChunkSize<256||this.maxChunkSize%256!=0||this.maxChunkSize<this.chunkSize||this.maxChunkSize<this.minChunkSize))throw new TypeError(`maxChunkSize must be a positive number in multiples of 256, and larger than or equal to both ${this.minChunkSize} and ${this.chunkSize}`);if(this.minChunkSize&&("number"!=typeof this.minChunkSize||this.minChunkSize<256||this.minChunkSize%256!=0||this.minChunkSize>this.chunkSize||this.minChunkSize>this.maxChunkSize))throw new TypeError(`minChunkSize must be a positive number in multiples of 256, and smaller than ${this.chunkSize} and ${this.maxChunkSize}`);if(this.maxFileBytes>0&&this.maxFileBytes<this.file.size)throw new Error(`file size exceeds maximum (${this.file.size} > ${this.maxFileBytes})`);if(this.attempts&&("number"!=typeof this.attempts||this.attempts<=0))throw new TypeError("retries must be a positive number");if(this.delayBeforeAttempt&&("number"!=typeof this.delayBeforeAttempt||this.delayBeforeAttempt<0))throw new TypeError("delayBeforeAttempt must be a positive number")}getEndpoint(){return"string"==typeof this.endpoint?(this.endpointValue=this.endpoint,Promise.resolve(this.endpoint)):this.endpoint(this.file).then((e=>(this.endpointValue=e,this.endpointValue)))}xhrPromise(e){let t=e=>{e.upload.onprogress=e=>{var t;let n=this.totalChunks-this.chunkCount,r=(this.file.size-this.nextChunkRangeStart)/this.file.size/n,i=this.nextChunkRangeStart/this.file.size,s=e.loaded/(null!=(t=e.total)?t:this.chunkByteSize)*r;this.dispatch("progress",Math.min(100*(i+s),100))}};return new Promise(((n,r)=>{this.currentXhr=(0,le.default)({...e,beforeSend:t},((e,t)=>(this.currentXhr=void 0,e?r(e):n(t))))}))}async sendChunk(e){let t=this.nextChunkRangeStart,n=t+e.size-1,r={...await("function"==typeof this.headers?this.headers():this.headers),"Content-Type":this.file.type,"Content-Range":`bytes ${t}-${n}/${this.file.size}`};return this.dispatch("attempt",{chunkNumber:this.chunkCount,totalChunks:this.totalChunks,chunkSize:this.chunkSize}),this.xhrPromise({headers:r,url:this.endpointValue,method:this.method,body:e})}async sendChunkWithRetries(e){let t,n=async(t,n)=>(this.dispatch("attemptFailure",{message:`An error occured uploading chunk ${this.chunkCount}. ${this.attempts-this.attemptCount} retries left.`,chunkNumber:this.chunkCount,attemptsLeft:this.attempts-this.attemptCount,response:t}),new Promise((t=>{setTimeout((async()=>{if(this._paused||this.offline)return this.pendingChunk=e,void t(!1);let n=await this.sendChunkWithRetries(e);t(n)}),1e3*this.delayBeforeAttempt)})));try{this.attemptCount=this.attemptCount+1,this.lastChunkStart=new Date,t=await this.sendChunk(e)}catch{}let r={retryCodes:this.retryCodes,attemptCount:this.attemptCount,attempts:this.attempts,currentChunkEndByte:this.nextChunkRangeStart+e.size-1};return ve(t,r)?n(t):ye(t)?(async(e,t)=>{var n;let r=((new Date).getTime()-this.lastChunkStart.getTime())/1e3;if(this.dispatch("chunkSuccess",{chunk:this.chunkCount,chunkSize:this.chunkSize,attempts:this.attemptCount,timeInterval:r,response:e}),this.attemptCount=0,this.chunkCount=(null!=(n=this.chunkCount)?n:0)+1,this.nextChunkRangeStart=this.nextChunkRangeStart+this.chunkByteSize,this.dynamicChunkSize){let e=this.chunkSize;r<10?e=Math.min(2*this.chunkSize,this.maxChunkSize):r>30&&(e=Math.max(this.chunkSize/2,this.minChunkSize)),this.chunkSize=256*Math.ceil(e/256);let t=(this.file.size-this.nextChunkRangeStart)/this.chunkByteSize;this.totalChunks=Math.ceil(this.chunkCount+t)}return!0})(t):ke(t,r)?(async(e,t)=>(this.dispatch("error",{message:`Server responded with ${e.statusCode}. Stopping upload.`,chunk:this.chunkCount,attempts:this.attemptCount,response:e}),!1))(t):n(t)}async sendChunks(){if(this.pendingChunk&&!this._paused&&!this.offline){let e=this.pendingChunk;this.pendingChunk=void 0;let t=await this.sendChunkWithRetries(e);this.success&&t&&this.dispatch("success")}for(;!(this.success||this._paused||this.offline);){let{value:e,done:t}=await this.chunkedStreamIterator.next(),n=!e&&t;if(e&&(n=await this.sendChunkWithRetries(e)),this.success=!!t,this.success&&n&&this.dispatch("success"),!n)return}}};function Ce(e){return Se.createUpload(e)}if("object"==typeof r.exports&&"object"==typeof n){r.exports=((e,t,n,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let i of Object.getOwnPropertyNames(t))Object.prototype.hasOwnProperty.call(e,i)||i===n||Object.defineProperty(e,i,{get:()=>t[i],enumerable:!(r=Object.getOwnPropertyDescriptor(t,i))||r.enumerable});return e})(r.exports,n)}return r.exports}));
//# sourceMappingURL=/sm/0f1ffc0208839ce4346b9ad0fafbf1dc59ed5ac487ab6a61a3bd1e807401fe9b.map